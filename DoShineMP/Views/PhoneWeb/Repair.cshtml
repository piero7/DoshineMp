
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section styles{
    <link href="~/Styles/rest.css" rel="stylesheet" />
    <link href="~/Styles/Repair.css" rel="stylesheet" />
}

<div class="keep">
    <div class="keep-in">
        <div class="keep-content-t clearfix marginB">
            <div class="keep-textarea">
                <textarea placeholder="请输入您要报修的内容..." id="keep"></textarea>
                <em class="br"></em>
            </div>

            <div class="col-xs-12 operate ">
                <input type="button" class="add-photo">
                <span class="commit pull-right" id="btn" onclick="btn()">提交</span>
            </div>
        </div>

        <div class="keep-content-b">
            <p class="panel panel-default new-title">
                <span>最新报修消息</span>
                <ins></ins>
            </p>
            <div class="panel panel-default new-keep">
                <ul id="messagenew">
                    @if (ViewBag.RepairList != null)
                    {
                        foreach (DoShineMP.Models.Repair r in ViewBag.RepairList as List<DoShineMP.Models.Repair>)
                        {
                            <li>
                                <div class="content-title-t">
                                    <div class="pull-left w8">
                                        <p class="wr-content">@r.Contenet</p>
                                    </div>
                                    <div class="pull-right w2">
                                        <div class="img"></div>
                                    </div>
                                </div>
                                <div class="content-title-b">
                                    @switch (r.Status)
                                    {
                                        case DoShineMP.Models.RepairStatus.Apply:
                                            <ins class="check check1 pull-left">已提交</ins>;
                                            break;
                                        case DoShineMP.Models.RepairStatus.Accept:
                                            <ins class="check check2 pull-left">已受理</ins>;
                                            break;
                                        case DoShineMP.Models.RepairStatus.Handle:
                                            <ins class="check check3 pull-left">处理中</ins>;
                                            break;
                                        case DoShineMP.Models.RepairStatus.FinishHandle:
                                            <ins class="check check4 pull-left">已完成</ins>;
                                            break;
                                        case DoShineMP.Models.RepairStatus.Finish:
                                            <ins class="check check4 pull-left">待确认</ins>;
                                            break;
                                    }
                                    <span class="time pull-right">@r.CreateDate</span>
                                </div>
                            </li>
                        }
                    }
                </ul>
            </div>
        </div>
    </div>
</div>
<input type="hidden" value="@ViewBag.openid" id="openid" />
@section scripts{
    <script src="~/Scripts/Commons.js"></script>
    <script type="text/javascript">
        function btn() {
            var keeptext = $('#keep').val();
            var code = $('#openid').val();
            if (keeptext == '' || keeptext == null) {
                alert('内容不得为空!')
                return false;
            }
            $.post('@Url.Action("RepairJson","PhoneWeb")', { code: code, content: keeptext }, function (data, status) {
                if (status == 'success') {
                    if (data.msg != 'N') {
                        $('#keep').val('');
                        //alert("提交成功！");
                        var str = '';
                        $.each(data, function (i, item) {
                            var time = $.timeStamp2String(item.CreateDate)
                            alert(item.Status);
                            var statusstr = '';
                            switch (item.Status) {
                                case 5: statusstr = '<ins class="check check1 pull-left">已提交</ins>'; break;
                                case 10: statusstr = '<ins class="check check2 pull-left">已受理</ins>'; break;
                                case 15: statusstr = '<ins class="check check3 pull-left">处理中</ins>'; break;
                                case 20: statusstr = '<ins class="check check4 pull-left">已完成</ins>'; break;
                                case 99: statusstr = '<ins class="check check4 pull-left">待确认</ins>'; break;
                            }
                            str += '<li>'
                                + '<div class="content-title-t">'
                                    + '<div class="pull-left w8">'
                                        + '<p class="wr-content">' + item.Contenet + '</p>'
                                    + '</div>'
                                    + '<div class="pull-right w2">'
                                       + ' <div class="img"></div>'
                                   + ' </div>'
                               + ' </div>'
                               + ' <div class="content-title-b">'
                                    + statusstr
                                    + '<span class="time pull-right">' + time + '</span>'
                               + ' </div>'
                            + '</li>';
                        })
                        $('#messagenew').html(str);
                        document.getElementById('btn').style.borderColor = '#4ca329';
                        document.getElementById('btn').style.color = '#4ca329';
                    }
                }
            })
        }

        function quxiao() {
            $('#keep').val('');
        }

    </script>
}
